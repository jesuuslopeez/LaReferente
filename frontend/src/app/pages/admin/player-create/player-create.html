<section class="admin-form">
  <header class="admin-form__header">
    <a routerLink="/jugadores" class="admin-form__back">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      Volver
    </a>
    <h1 class="admin-form__title">Añadir jugador</h1>
  </header>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="admin-form__form">
    <section class="admin-form__row">
      <section class="admin-form__field">
        <label for="nombre" class="admin-form__label">Nombre *</label>
        <input
          type="text"
          id="nombre"
          formControlName="nombre"
          class="admin-form__input"
          placeholder="Ej: Pedri"
        />
        @if (form.get('nombre')?.invalid && form.get('nombre')?.touched) {
          <span class="admin-form__error">El nombre es obligatorio</span>
        }
      </section>

      <section class="admin-form__field">
        <label for="apellidos" class="admin-form__label">Apellidos *</label>
        <input
          type="text"
          id="apellidos"
          formControlName="apellidos"
          class="admin-form__input"
          placeholder="Ej: González López"
        />
        @if (form.get('apellidos')?.invalid && form.get('apellidos')?.touched) {
          <span class="admin-form__error">Los apellidos son obligatorios</span>
        }
      </section>
    </section>

    <section class="admin-form__row">
      <section class="admin-form__field">
        <label for="fechaNacimiento" class="admin-form__label">Fecha de nacimiento *</label>
        <input
          type="date"
          id="fechaNacimiento"
          formControlName="fechaNacimiento"
          class="admin-form__input"
        />
        @if (form.get('fechaNacimiento')?.invalid && form.get('fechaNacimiento')?.touched) {
          <span class="admin-form__error">La fecha de nacimiento es obligatoria</span>
        }
      </section>

      <section class="admin-form__field admin-form__field--autocomplete">
        <label class="admin-form__label">Nacionalidad *</label>
        <section class="autocomplete">
          <input
            type="text"
            class="admin-form__input"
            [class.admin-form__input--invalid]="!paisValido() && paisInput().length > 0"
            [value]="paisInput()"
            (input)="onPaisInputChange($any($event.target).value)"
            (focus)="mostrarPaisSugerencias()"
            (blur)="ocultarPaisSugerencias()"
            placeholder="Buscar país..."
            autocomplete="off"
          />
          @if (showPaisSugerencias() && paisSugerencias().length > 0) {
            <ul class="autocomplete__list">
              @for (pais of paisSugerencias(); track pais.es_name) {
                <li
                  class="autocomplete__item"
                  (mousedown)="seleccionarPais(pais)"
                >
                  <span class="autocomplete__pais">{{ pais.es_name }}</span>
                  <span class="autocomplete__pais-en">{{ pais.name }}</span>
                </li>
              }
            </ul>
          }
        </section>
        @if (!paisValido() && paisInput().length > 0) {
          <span class="admin-form__hint admin-form__hint--error">Selecciona un país de la lista</span>
        }
      </section>
    </section>

    <section class="admin-form__row">
      <section class="admin-form__field">
        <label for="posicion" class="admin-form__label">Posición *</label>
        <select id="posicion" formControlName="posicion" class="admin-form__select">
          @for (pos of posiciones; track pos.valor) {
            <option [value]="pos.valor">{{ pos.texto }}</option>
          }
        </select>
      </section>

      <section class="admin-form__field">
        <label for="categoria" class="admin-form__label">Categoría *</label>
        <select id="categoria" formControlName="categoria" class="admin-form__select">
          @for (c of categorias; track c.valor) {
            <option [value]="c.valor">{{ c.texto }}</option>
          }
        </select>
      </section>
    </section>

    <section class="admin-form__row">
      <section class="admin-form__field">
        <label for="dorsal" class="admin-form__label">Dorsal</label>
        <input
          type="number"
          id="dorsal"
          formControlName="dorsal"
          class="admin-form__input"
          placeholder="Ej: 8"
          min="1"
          max="99"
        />
      </section>

      <section class="admin-form__field">
        <label class="admin-form__label">Equipo</label>
        <app-team-search
          [categoria]="categoriaActual"
          (teamSelected)="onTeamSelected($event)"
        />
      </section>
    </section>

    <section class="admin-form__row">
      <section class="admin-form__field">
        <label for="altura" class="admin-form__label">Altura (cm)</label>
        <input
          type="number"
          id="altura"
          formControlName="altura"
          class="admin-form__input"
          placeholder="Ej: 174"
        />
      </section>

      <section class="admin-form__field">
        <label for="peso" class="admin-form__label">Peso (kg)</label>
        <input
          type="number"
          id="peso"
          formControlName="peso"
          class="admin-form__input"
          placeholder="Ej: 68"
        />
      </section>
    </section>

    <section class="admin-form__field">
      <app-image-upload
        label="Foto del jugador"
        (imageUploaded)="onImageUploaded($event)"
        (imageRemoved)="onImageRemoved()"
      />
    </section>

    <section class="admin-form__field">
      <label for="biografia" class="admin-form__label">Biografía</label>
      <textarea
        id="biografia"
        formControlName="biografia"
        class="admin-form__textarea"
        rows="4"
        placeholder="Biografía del jugador..."
      ></textarea>
    </section>

    <section class="admin-form__field admin-form__field--checkbox">
      <label class="admin-form__checkbox-label">
        <input type="checkbox" formControlName="activo" class="admin-form__checkbox" />
        <span>Jugador activo</span>
      </label>
    </section>

    <section class="admin-form__actions">
      <a routerLink="/jugadores" class="admin-form__btn admin-form__btn--secondary">Cancelar</a>
      <button type="submit" class="admin-form__btn admin-form__btn--primary" [disabled]="cargando">
        @if (cargando) {
          Guardando...
        } @else {
          Crear jugador
        }
      </button>
    </section>
  </form>
</section>
